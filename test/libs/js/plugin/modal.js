/*!
 * @name modal v1.1
 * @author ahuing
 * @link 08cms.com
 * @date 2015-12-31 09:03:41
 */
define(function(require,exports,t){function s(){var t,o=document.createElement("div"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in s)if(void 0!==o.style[t])return{end:s[t]};return!1}function i(t){return this.each(function(){var o=$(this),s=o.data("jqDrag"),i=$.extend({},d.defaults,o.data(),"object"==typeof t&&t);s||(o.data("jqDrag",s=new d(this,i)),s.init()),"string"==typeof t&&s[t]()})}function e(t,o){return this.each(function(){var s=$(this),i=s.data("jqModal"),e=$.extend({},r.defaults,s.data(),"object"==typeof t&&t);i?"string"==typeof t?i[t](o):i["toggle"]():(s.data("jqModal",i=new r(this,e)),i.init(),i.show(o))})}var n,a,d,r,l,$=require("$");$.fn.emulateTransitionEnd=function(t){var o,s=!1,i=this;return $(this).one("bsTransitionEnd",function(){s=!0}),o=function(){s||$(i).trigger($.support.transition.end)},setTimeout(o,t),this},$(function(){$.support.transition=s(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(t){return $(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})}),n=!-[1]&&!window.XMLHttpRequest,a=function(t,o,s){var i=$(s?o||window:"body"),e=$(window).scrollTop(),n=t.outerWidth(),a=t.outerHeight(),d=i.width(),r=i.height();return{minL:n>d?d-n:0,minT:a>r?r-a:0,maxL:n>d?0:i.width()-n,maxT:a>r?0:i.height()-a,st:e,h:a}},d=function(t,o){this.o=$.extend({},d.defaults,o),this.$self=$(t),this.$handle=this.o.handle&&this.$self.find(this.o.handle)||this.$self},d.defaults={handle:"",fixed:1,attachment:""},d.prototype.init=function(){var t=this.o,o=this.$self.css("animation-fill-mode","backwards"),s=this.$handle;s.css({cursor:"move"}).on("selectstart",function(){return!1}).on("mousedown",function(s){return o.css({opacity:t.opacity,zIndex:parseInt((new Date).getTime()/1e3)}).trigger("_mousemove",[s.pageX,s.pageY]),!1}).on("_mousemove",function(s,i,e){var d,r,l=a(o,t.attachment,t.fixed),c=o.position(),h=c.left-i,f=c.top-e;o.trigger("dragStart",[l]),$(document).on("mousemove",function(s){s.preventDefault();var i=h+s.pageX,e=f+s.pageY;d=i<l.minL?l.minL:i>l.maxL?l.maxL:i,r=e<l.minT?l.minT:e>l.maxT?l.maxT:e,o.css({left:d,top:r+(n&&t.fixed&&l.st||0)}).trigger("drag",[d,r])}).on("mouseup",function(){$(this).off("mousemove"),o.trigger("dragEnd",[d,r])})})},$.fn.jqDrag=i,r=function(t,o){this.o=o,this.Z=parseInt((new Date).getTime()/1e3),this.$self=$(t),this.isShown=!1},r.defaults={mclass:"modal",head:"",foot:"",remote:"",fixed:1,overlay:.3,drag:1,lock:0,timeout:0,css:{},headcss:{},bodycss:{},footcss:{},animate:"bounceInDown"},r.prototype={init:function(){var t=this,o=t.o,s=(o.target,'<div class="jqModal animated">    <div class="m-content m-'+o.mclass+'">        <div class="m-head">'+o.head+'</div>        <div class="m-body"></div>        <div class="m-foot">'+o.foot+'</div>        <i class="font-modal-close" data-close="1" title="关闭" href="#"></i>    </div></div>');o.overlay&&(t.$overlay=$('<div class="m-overlay"></div>').appendTo("body").css({opacity:o.overlay,zIndex:t.Z}).on("click",!o.lock&&$.proxy(t.hide,t)||$.noop)),t.$box=$(s).appendTo("body").css($.extend({},o.css,{zIndex:t.Z,position:o.fixed&&!n&&"fixed"||"absolute"})).on("click","[data-close]",$.proxy(t.hide,t)),t.$hd=t.$box.find(".m-head").css($.extend({},o.headcss,!o.head&&{display:"none"})),t.$bd=t.$box.find(".m-body").css(o.bodycss),t.$ft=t.$box.find(".m-foot").css($.extend({},o.footcss,!o.foot&&{display:"none"})),n&&$("select").css("visibility","hidden"),t.$self.is("iframe")?t.$self.attr({scrolling:"no",allowtransparency:!0,frameborder:0,src:o.remote}).appendTo(this.$bd).load(function(){t.setPos(1)}):t.$bd.append(t.$self.css("display","block")),o.drag&&(t.$drag=$('<div class="jqModal-drag"></div>').insertAfter(t.$box),t.$hd.on("mousedown",function(s){t.$drag.css("display","block").trigger("_mousemove",[s.pageX,s.pageY]),o.drag>1&&t.$drag.addClass("jqModal-drag-style")}),$(document).on("mouseup",function(){t.$drag.css("display","none"),o.drag>1&&t.$drag.removeClass("jqModal-drag-style")}),t.$drag.on(o.drag>1?"dragEnd":"drag",function(o,s,i){t.$box.css({left:s,top:i})}),n&&t.$drag.on("dragEnd",function(o,s,i){t.fixedT=i})),this.setPos(),$(document).on("keydown.modal",function(o){return 27==o.which&&t.hide(),!0}),o.fixed&&$(window).on("resize",$.proxy(t.setPos,t))},show:function(t){var o=this;o.isShown||(o.$self.trigger("showFun"),o.$overlay&&o.$overlay.css("display","block"),o.$box.css("display","block"),$.support.transition&&o.$box.addClass(o.o.animate),o.$self.trigger("shownFun"),o.isShown=!0,(t||this.o.timeout)&&(clearTimeout(this.t),this.t=setTimeout($.proxy(this.hide,this),t||this.o.timeout)))},hideModal:function(){this.$box.removeClass(this.o.animate+"H").hide(),this.$overlay&&this.$overlay.hide(),this.$self.trigger("hidenFun")},hide:function(t){return this.$self.trigger("hideFun"),setTimeout($.proxy(function(){this.$box.removeClass(this.o.animate).addClass(this.o.animate+"H"),$.support.transition&&this.$box.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(500)||this.hideModal()},this),t||0),n&&($("select").css("visibility","visible"),$(window).off("scroll.modal")),this.isShown=!1,!1},toggle:function(t){return this.isShown?this.hide(t):this.show()},setSize:function(){this.$self.is("iframe")&&this.$self.add(this.$bd).height(this.$self.css("background","none").contents().find("body").height())},setPos:function(t){var s,e;t&&this.setSize(),s=this,o=s.o,R=a(s.$box,null,o.fixed),s.fixedT=o.css.bottom>=0?R.maxT-o.css.bottom:o.css.top||($(window).height()-R.h)/2,s.$box.css({left:o.css.right>=0?"auto":o.css.left||R.maxL/2,top:s.fixedT+((n||!o.fixed)&&R.st)}),n&&o.fixed&&(e=$(window),e.on("scroll.modal",function(){s.$box.css({top:s.fixedT+e.scrollTop()})})),o.drag&&(s.$drag[0].style.cssText=s.$box[0].style.cssText,s.$drag.css({width:s.$box.width()-6,height:s.$box.height()-6}),i.call(s.$drag,{fixed:s.o.fixed}))}},l=$.fn.jqModal,$.fn.jqModal=e,$.fn.jqModal.Constructor=r,$.fn.jqModal.noConflict=function(){return $.fn.jqModal=l,this},$(document).on("click",".btn-jqModal",function(t){var o,s,i,n=$(this),a=n.data("target")||n.attr("href");"string"==typeof a?(o=0==a.indexOf("http"),s=$(o&&'<iframe class="jqiframe"/>'||a.replace(/.*(?=#[^\s]+$)/,"")),n.data("target",s),i=$.extend({remote:o&&a},s.data(),n.data())):(s=a,i="toggle"),n.is("a")&&t.preventDefault(),e.call(s,i)}),t.exports={tip:function(){var t=$(".jqtip"),o=-1!=arguments[1].indexOf("load")?arguments[2]:arguments[2]||1500,s=t[0]&&"show"||{mclass:"tip",animate:"shake",css:{top:100},drag:0,lock:1};t[0]||(t=$('<div class="jqtip"></div>')),e.call(t.html('<i class="font-modal-'+arguments[1]+'"></i>'+arguments[0]),s,o)},alert:function(){var t=$(".jqalert"),o=t[0]&&"show"||{head:arguments[2]||"提示信息",css:{width:300},foot:'<button data-close="1" class="ok">确定</button>'};t[0]||(t=$('<div class="jqalert"></div>')),e.call(t.html('<i class="font-modal-'+(arguments[1]||"info")+'"></i>'+arguments[0]),o)},confirm:function(){var t=$(".jqconfirm"),o=t[0]&&"show"||{head:arguments[1]||"提示信息",css:{width:300},foot:'<button data-close="1" class="ok" data-btn="ok">确定</button><button data-close="1" data-btn="no">取消</button>'};t[0]||(t=$('<div class="jqconfirm"></div>')),e.call(t.html('<i class="font-modal-'+(arguments[2]||"ask")+'"></i>'+arguments[0]),o)},lay:function(t){var o=t;$(".jqlay").length?("hide"!=t&&$(".jqlay").html(o),$(".jqlay").jqModal(t)):$('<div class="jqlay">'+o+"</div>").appendTo("body").jqModal()}}});
//# sourceMappingURL=../../../maps/libs/js/plugin/modal.js.map
